variables:
  OP_PATH: "operator"
  CLEAN_MODE: "NORMAL"
  INSTALL_MODE: ""

stages:
  - test

test-build:
 stage: test
 script:
  - sudo docker pull quay.io/operator-framework/operator-testing
  - sudo docker run -v ${HOME}/.kube/config:/root/.kube/config -v ${HOME}/.minikube:${HOME}/.minikube -v ${PWD}:${PWD} quay.io/operator-framework/operator-testing operator.test --no-print-directory OP_PATH="${CI_PROJECT_DIR}/${OP_PATH}" CLEAN_MODE=${CLEAN_MODE} INSTALL_MODE=${INSTALL_MODE} VERBOSE=1

before_script:
  - export  CHANGE_MINIKUBE_NONE_USER=true
  - sudo minikube start --vm-driver=none --extra-config=apiserver.v=4

after_script:
  - sudo minikube delete
