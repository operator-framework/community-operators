variables:
  OP_PATH: "operator"
  CLEAN_MODE: "FORCE"
  INSTALL_MODE: ""

stages:
  - test

test-build:
 stage: test
 script:
  - sudo docker pull quay.io/operator-framework/operator-testing
  - sudo docker run -v ${HOME}/.kube/config:/root/.kube/config -v ${HOME}/.minikube:${HOME}/.minikube -v ${PWD}:${PWD} quay.io/operator-framework/operator-testing operator.test --no-print-directory OP_PATH="${CI_PROJECT_DIR}/${OP_PATH}" CLEAN_MODE=${CLEAN_MODE} INSTALL_MODE=${INSTALL_MODE} VERBOSE=1


.functions: &functions |
    # Functions
    function init_kubeconfig() {
        mkdir -p /root/.kube
        echo ${KUBECONFIG} | base64 -d > /root/.kube/config
        export KUBECONFIG=/root/.kube/config
    }

before_script:
- *functions
