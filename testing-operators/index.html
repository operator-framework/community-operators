
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-5.0.2" name="generator"/>
<title>Explained - Community operators</title>
<link href="../assets/stylesheets/main.c1a4d03f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#testing-your-operator-with-operator-framework">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="Community operators" class="md-header-nav__button md-logo" href=".." title="Community operators">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            Community operators
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Explained
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Type to start searching
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/operator-framework/community-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    community-operators
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Community operators" class="md-nav__button md-logo" href=".." title="Community operators">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z"></path></svg>
</a>
    Community operators
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/operator-framework/community-operators/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    community-operators
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href=".." title="Home">
      Home
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      Operator
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path></svg>
</span>
</label>
<nav aria-label="Operator" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</span>
        Operator
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" id="nav-2-1" type="checkbox"/>
<label class="md-nav__link" for="nav-2-1">
      Implementation
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path></svg>
</span>
</label>
<nav aria-label="Implementation" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-2-1">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</span>
        Implementation
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing/" title="How to">
      How to
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../required-fields/" title="Required fields">
      Required fields
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operator-versioning/" title="Versioning">
      Versioning
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" id="nav-2-3" type="checkbox"/>
<label class="md-nav__link" for="nav-2-3">
      Testing
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path></svg>
</span>
</label>
<nav aria-label="Testing" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-2-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</span>
        Testing
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Explained
        <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"></path></svg>
</span>
</label>
<a class="md-nav__link md-nav__link--active" href="./" title="Explained">
      Explained
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
    Overview
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accepted-contribution-formats">
    Accepted Contribution formats
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-requisites">
    Pre-Requisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operator-metadata-validation">
    Operator Metadata Validation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#publishing-your-operator-metadata-to-a-catalog-for-testing">
    Publishing your Operator metadata to a catalog for testing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-operator-deployment-on-kubernetes">
    Testing Operator Deployment on Kubernetes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-operator-deployment-on-openshift">
    Testing Operator Deployment on OpenShift
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-with-scorecard">
    Testing with scorecard
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#additional-resources">
    Additional Resources
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../using-current-test-suite/" title="Via test suite">
      Via test suite
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing-via-pr/" title="Contribution">
      Contribution
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operator-deployment/" title="Deployment">
      Deployment
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../best-practices/" title="Best practices">
      Best practices
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../troubleshooting/" title="Troubleshooting">
      Troubleshooting
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci/" title="Continues Integration">
      Continues Integration
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
    Overview
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accepted-contribution-formats">
    Accepted Contribution formats
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-requisites">
    Pre-Requisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operator-metadata-validation">
    Operator Metadata Validation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#publishing-your-operator-metadata-to-a-catalog-for-testing">
    Publishing your Operator metadata to a catalog for testing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-operator-deployment-on-kubernetes">
    Testing Operator Deployment on Kubernetes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-operator-deployment-on-openshift">
    Testing Operator Deployment on OpenShift
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-with-scorecard">
    Testing with scorecard
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#additional-resources">
    Additional Resources
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/operator-framework/community-operators/edit/master/docs/testing-operators.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"></path></svg>
</a>
<h1 id="testing-your-operator-with-operator-framework">Testing your Operator with Operator Framework</h1>
<p><!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<!-- **Table of Contents**  *generated with <a href="https://github.com/thlorenz/doctoc">DocToc</a>*--></p>
<!-- - [Overview](#overview)
- [Accepted Contribution formats](#accepted-contribution-formats)
  - [*packagemanifest* format (mandatory for all OLM versions prior to 0.14.0 and earlier, supported on all available versions)](#packagemanifest-format-mandatory-for-all-olm-versions-prior-to-0140-and-earlier-supported-on-all-available-versions)
  - [*bundle* format (supported with 0.14.0 or newer)](#bundle-format-supported-with-0140-or-newer)
- [Pre-Requisites](#pre-requisites)
  - [Kubernetes cluster](#kubernetes-cluster)
  - [Container Tooling](#container-tooling)
  - [Operator Framework components](#operator-framework-components)
  - [Preparing file structure](#preparing-file-structure)
- [Operator Metadata Validation](#operator-metadata-validation)
  - [Temporary conversion of packagemanifest to bundle](#temporary-conversion-of-packagemanifest-to-bundle)
  - [Using operator-sdk to validate your Operator](#using-operator-sdk-to-validate-your-operator)
- [Publishing your Operator metadata to a catalog for testing](#publishing-your-operator-metadata-to-a-catalog-for-testing)
  - [Building a catalog using `packagemanifest` format](#building-a-catalog-using-packagemanifest-format)
  - [Building a catalog using bundles](#building-a-catalog-using-bundles)
- [Testing Operator Deployment on Kubernetes](#testing-operator-deployment-on-kubernetes)
  - [Installing Operator Lifecycle Manager](#1-installing-operator-lifecycle-manager)
  - [Adding the catalog containing your Operator](#2-adding-the-catalog-containing-your-operator)
  - [View Available Operators](#3-view-available-operators)
  - [Create an OperatorGroup](#4-create-an-operatorgroup)
  - [Create a Subscription](#5-create-a-subscription)
  - [Verify Operator health](#6-verify-operator-health)
- [Testing Operator Deployment on OpenShift](#testing-operator-deployment-on-openshift)
  - [1. Create the CatalogSource](#1-create-the-catalogsource)
  - [2. Find your Operator in the OperatorHub UI](#2-find-your-operator-in-the-operatorhub-ui)
  - [3. Install your Operator from OperatorHub](#3-install-your-operator-from-operatorhub)
  - [4. Verify Operator health](#4-verify-operator-health)
- [Testing with scorecard](#testing-with-scorecard)
- [Additional Resources](#additional-resources) -->
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview">Overview</h2>
<p>These instructions walk you through how to manually test that your Operator deploys correctly with Operator Framework, when packaged for the Operator Lifecycle Manager. Although your submission will always be tested as part of the <a href="../ci/">CI</a> you can accelerate the process by testing locally.</p>
<blockquote>
<p>The tests described in this document can also be executed automatically in a single step using a <a href="../using-current-test-suite/">test suite</a></p>
<p>A previous version of this document required quay.io, <code>operator-courier</code> and <code>operator-marketplace</code> to conduct the tests. This is no longer required.</p>
</blockquote>
<h2 id="accepted-contribution-formats">Accepted Contribution formats</h2>
<p>The process below assumes that you have a Kubernetes Operator in either of the two following formats supported by the Operator Framework:</p>
<h3><em>packagemanifest</em> format (mandatory for all OLM versions prior to 0.14.0 and earlier, supported on all available versions)</h3>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> tree my-operator/

<span class="go">my-operator</span>
<span class="go">├── 0.1.0</span>
<span class="go">│   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   └── my-operator.v0.1.0.clusterserviceversion.yaml</span>
<span class="go">├── 0.5.0</span>
<span class="go">│   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   └── my-operator.v0.5.0.clusterserviceversion.yaml</span>
<span class="go">├── 1.0.0</span>
<span class="go">│   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   └── my-operator.v1.0.0.clusterserviceversion.yaml</span>
<span class="go">└── my-operator.package.yaml</span>
</code></pre></div>
<h3><em>bundle</em> format (supported with 0.14.0 or newer)</h3>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> tree my-operator/

<span class="go">my-operator</span>
<span class="go">├── 0.1.0</span>
<span class="go">│   ├── manifests</span>
<span class="go">│   │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   │   └── my-operator.v0.1.0.clusterserviceversion.yaml</span>
<span class="go">│   ├── metadata</span>
<span class="go">│   │   └── annotations.yaml</span>
<span class="go">│   └── Dockerfile</span>
<span class="go">├── 0.5.0</span>
<span class="go">│   ├── manifests</span>
<span class="go">│   │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   │   └── my-operator.v0.5.0.clusterserviceversion.yaml</span>
<span class="go">│   ├── metadata</span>
<span class="go">│   │   └── annotations.yaml</span>
<span class="go">│   └── Dockerfile</span>
<span class="go">└── 1.0.0</span>
<span class="go">    ├── manifests</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">    │   └── my-operator.v1.0.0.clusterserviceversion.yaml</span>
<span class="go">    ├── metadata</span>
<span class="go">    │   └── annotations.yaml</span>
<span class="go">    └── Dockerfile</span>
<span class="go">...</span>
</code></pre></div>
<p>In both examples above <em>my-operator</em> is the name of your Operator which is available in 3 versions: <code>0.1.0</code>, <code>0.5.0</code> and <code>1.0.0</code>. If you are new to this or you don't have this format yet, refer to our <a href="../contributing/#package-your-operator">contribution documentation</a>. We will refer to both formats distinctively below where required.</p>
<blockquote>
<p>Mixing <code>packagemanifest</code> style and <code>bundle</code> format style Operator versions in a single Operator package <strong>is not supported</strong>. All versions all need to be in either one or the other format.</p>
</blockquote>
<h2 id="pre-requisites">Pre-Requisites</h2>
<h3>Kubernetes cluster</h3>
<p>For "<strong>upstream-community</strong>" operators targeting Kubernetes and <a href="https://operatorhub.io">OperatorHub.io</a>:
* A running Kubernetes cluster; <a href="https://kubernetes.io/docs/setup/minikube/">minikube</a> or <a href="https://kind.sigs.k8s.io/">Kubernetes-in-Docker</a> is the simplest approach</p>
<p>For "<strong>community</strong>" operators targeting OCP/OKD and OperatorHub on OpenShift:
* access to a running production-like OpenShift 4 cluster, use <a href="https://try.openshift.com/">try.openshift.com</a> to get a cluster on infrastructure of your choice
* or access to all-in-one OpenShift 4 cluster, use <a href="https://cloud.redhat.com/openshift/install/crc/installer-provisioned">CodeReady Containers</a> to get a cluster on your local machine</p>
<h3>Container Tooling</h3>
<p>You need an OCI compatible container toolchain on the system where you test your Operator. Support options are:</p>
<ul>
<li><a href="https://podman.io/">podman</a></li>
<li><a href="https://buildah.io/">buildah</a></li>
<li>moby (aka <em>docker-ce</em> aka <em>docker</em>)</li>
</ul>
<h3>Operator Framework components</h3>
<p>The following parts of the framework are used throughout the process and should be downloaded and put in your executable search path (Linux and Mac are supported):</p>
<ul>
<li><a href="https://github.com/operator-framework/operator-registry/releases/latest">opm</a></li>
<li><a href="https://github.com/operator-framework/operator-sdk/releases/latest">operator-sdk</a></li>
</ul>
<h3>Preparing file structure</h3>
<p>Finally, if you haven't already done so, please clone this repository as well and create a branch:</p>
<div class="codehilite"><pre><span></span><code><span class="go">git clone https://github.com/operator-framework/community-operators.git</span>
<span class="go">cd community-operators/</span>
<span class="go">git branch my-operator</span>
</code></pre></div>
<p>For simplicity (and if your Operator has dependencies on other community Operators) put your <code>my-operator</code> directory in either of the <strong>community-operators</strong> (for OpenShift's OperatorHub) or <strong>upstream-community-operators</strong> (for OperatorHub.io) directory (or both).</p>
<div class="codehilite"><pre><span></span><code><span class="go">cp -R my-operator/ community-operators/upstream-community-operators/</span>
</code></pre></div>
<blockquote>
<p>The name of the directory <code>my-operator/</code> needs to match the Operator package name (without the slash) in either <code>package.yaml</code> (if you are using the <code>packagemanifest</code> format) or the container image label <code>operators.operatorframework.io.bundle.package.v1</code> in the <code>Dockerfile</code> and <code>annotations.yaml</code> (if you are using the <code>bundle</code> format).</p>
</blockquote>
<p>If you are just adding a new version of your Operator, please create a subdirectory following <a href="https://semver.org">semver</a> conventions in your existing package directory, for example:</p>
<div class="codehilite"><pre><span></span><code><span class="go">cp -R my-operator/2.0.0 community-operators/upstream-community-operators/my-operator/</span>
</code></pre></div>
<blockquote>
<p>If you are using the <code>packagemanifest</code> format, don't forget to update the <code>package.yaml</code> file in the top-level directory to point to your new version/channels.</p>
</blockquote>
<h2 id="operator-metadata-validation">Operator Metadata Validation</h2>
<p>If you are using <code>packagemanifest</code> format you will need to convert your metadata to <code>bundle</code> format for the validation step. In theory the previous <code>operator-courier</code> tool still works but it is no longer maintained.</p>
<h3>Temporary conversion of packagemanifest to bundle</h3>
<p>Suppose <code>v2.0.0</code> is the version of the Operator you want to test convert to bundle format directory with the <code>opm</code> tool:</p>
<div class="codehilite"><pre><span></span><code><span class="go">mkdir /tmp/my-operator-2.0.0-bundle/</span>
<span class="go">cd /tmp/my-operator-2.0.0-bundle/</span>
<span class="go">opm alpha bundle build --directory /path/to/my-operator/2.0.0/ --tag my-operator-bundle:v2.0.0 --output-dir .</span>
</code></pre></div>
<p>This will have generated the bundle format layout in the current working directory <code>/tmp/my-operator-2.0.0-bundle/</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> tree .

<span class="go">/tmp/my-operator-2.0.0-bundle/</span>
<span class="go">├── manifests</span>
<span class="go">│   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   └── my-operator.v2.0.0.clusterserviceversion.yaml</span>
<span class="go">├── metadata</span>
<span class="go">│   └── annotations.yaml</span>
<span class="go">└── bundle.Dockerfile</span>
</code></pre></div>
<p>Run the following validation command of the <code>operator-sdk</code> from within this directory.</p>
<div class="codehilite"><pre><span></span><code><span class="go">operator-sdk bundle validate /tmp/my-operator-2.0.0-bundle/ --select-optional name=operatorhub</span>
</code></pre></div>
<h3>Using operator-sdk to validate your Operator</h3>
<blockquote>
<p>Validation using <code>operator-sdk</code> is only supported using the <code>bundle</code> format layout. See the previous step if you need to convert from <code>packagemanifest</code>.</p>
</blockquote>
<p>Validation is done on a per-Operator version basis. If you are not already in the Operator versions directory, switch to it now, e.g.</p>
<div class="codehilite"><pre><span></span><code><span class="go">cd my-operator/2.0.0/</span>
</code></pre></div>
<p>With the Operator in bundle format use the <code>operator-sdk</code> to validate your bundle with the additional rules for community submissions:</p>
<div class="codehilite"><pre><span></span><code><span class="go">operator-sdk bundle validate --select-optional name=operatorhub .</span>
</code></pre></div>
<p>The output might look similar to this:</p>
<div class="codehilite"><pre><span></span><code><span class="go">INFO[0000] Found annotations file                        bundle-dir=. container-tool=docker</span>
<span class="go">INFO[0000] Could not find optional dependencies file     bundle-dir=. container-tool=docker</span>
<span class="go">INFO[0000] All validation tests have completed successfully</span>
</code></pre></div>
<p>If there are any errors or warnings they will be displayed there. The container-tool will be automatically determined given your environment. If you want to force to use <code>podman</code> instead of <code>docker</code>, supply the <code>-b</code> switch to the <code>operator-sdk bundle validate command</code>.</p>
<p>Any warnings here might turn into failing pipeline tests here. Please correct all issues displayed. A list of fields that are scanned can also be reviewed with <a href="https://github.com/operator-framework/community-operators/blob/master/docs/required-fields.md">this list</a>.</p>
<h2 id="publishing-your-operator-metadata-to-a-catalog-for-testing">Publishing your Operator metadata to a catalog for testing</h2>
<h3>Building a catalog using <code>packagemanifest</code> format</h3>
<p>When your Operator metadata is formatted in <code>packagemanifest</code> layout you need to place it in the directory structure of the <code>community-operators</code> repository, according to <a href="#preparing-file-structure">pre-requisites step</a>.</p>
<p>For example, assuming version <code>2.0.0</code> is the version you like to test:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> tree upstream-community-operators/

<span class="go">upstream-community-operators/</span>
<span class="go">│</span>
<span class="go">...</span>
<span class="go">│</span>
<span class="go">└──my-operator/</span>
<span class="go">    ├── 0.1.0</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   └── my-operator.v0.1.0.clusterserviceversion.yaml</span>
<span class="go">    ├── 0.5.0</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">    │   └── my-operator.v0.5.0.clusterserviceversion.yaml</span>
<span class="go">    ├── 1.0.0</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">    │   └── my-operator.v1.0.0.clusterserviceversion.yaml</span>
<span class="go">    ├── 2.0.0</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">    │   └── my-operator.v2.0.0.clusterserviceversion.yaml</span>
<span class="go">    └── my-operator.package.yaml</span>
</code></pre></div>
<p>You can build a catalog for OLM containing either all Operators or just yours with a <code>Dockerfile</code> like <a href="https://github.com/operator-framework/operator-registry/blob/master/upstream-example.Dockerfile">this</a></p>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span> <span class="s">quay.io/operator-framework/upstream-registry-builder</span> <span class="k">as</span> <span class="s">builder</span>

<span class="k">COPY</span> upstream-community-operators manifests
<span class="k">RUN</span> /bin/initializer -o ./bundles.db

<span class="k">FROM</span> <span class="s">scratch</span>
<span class="k">COPY</span> --from<span class="o">=</span>builder /etc/nsswitch.conf /etc/nsswitch.conf
<span class="k">COPY</span> --from<span class="o">=</span>builder /bundles.db /bundles.db
<span class="k">COPY</span> --from<span class="o">=</span>builder /bin/registry-server /registry-server
<span class="k">COPY</span> --from<span class="o">=</span>builder /bin/grpc_health_probe /bin/grpc_health_probe
<span class="k">EXPOSE</span><span class="s"> 50051</span>
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">"/registry-server"</span><span class="p">]</span>
<span class="k">CMD</span> <span class="p">[</span><span class="s2">"--database"</span><span class="p">,</span> <span class="s2">"bundles.db"</span><span class="p">]</span>
</code></pre></div>
<p>Simply adjust the second line to either include all OpenShift Community Operators (<code>community-operators</code>), or all OperatorHub.io Operators (<code>upstream-community-operators</code>) or just your Operator (e.g. <code>upstream-community-operator/my-operator</code>).</p>
<p>Place the <code>Dockerfile</code> in the top-level directory of your cloned copy of this repo, build it and push to a registry from where you can download it to your Kubernetes cluster later.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code><span class="go">podman build -f catalog.Dockerfile -t my-test-catalog:latest .</span>
<span class="go">podman tag my-test-catalog:latest quay.io/myaccount/my-test-catalog:latest</span>
<span class="go">podman push quay.io/myaccount/my-test-catalog:latest</span>
</code></pre></div>
<h3>Building a catalog using bundles</h3>
<p>When your Operator metadata is formatted in <code>bundle</code> layout you can optionally add it to the existing directory structure like described in the <a href="#preparing-file-structure">pre-requisites step</a>. For building a catalog this is not required because with Operator <code>bundles</code> versions are incrementally added to an existing or empty catalog.</p>
<p>For example, assuming version <code>2.0.0</code> is the version you like to test:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> tree my-operator/

<span class="go">my-operator/</span>
<span class="go">├── 0.1.0</span>
<span class="go">│   ├── manifests</span>
<span class="go">│   │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   │   └── my-operator.v0.1.0.clusterserviceversion.yaml</span>
<span class="go">│   ├── metadata</span>
<span class="go">│   │   └── annotations.yaml</span>
<span class="go">│   └── Dockerfile</span>
<span class="go">├── 0.5.0</span>
<span class="go">│   ├── manifests</span>
<span class="go">│   │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   │   └── my-operator.v0.5.0.clusterserviceversion.yaml</span>
<span class="go">│   ├── metadata</span>
<span class="go">│   │   └── annotations.yaml</span>
<span class="go">│   └── Dockerfile</span>
<span class="go">├── 1.0.0</span>
<span class="go">│   ├── manifests</span>
<span class="go">│   │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">│   │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">│   │   └── my-operator.v1.0.0.clusterserviceversion.yaml</span>
<span class="go">│   ├── metadata</span>
<span class="go">│   │   └── annotations.yaml</span>
<span class="go">│   └── Dockerfile</span>
<span class="go">└── 2.0.0</span>
<span class="go">    ├── manifests</span>
<span class="go">    │   ├── my-operator-crd1.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd2.crd.yaml</span>
<span class="go">    │   ├── my-operator-crd3.crd.yaml</span>
<span class="go">    │   └── my-operator.v2.0.0.clusterserviceversion.yaml</span>
<span class="go">    ├── metadata</span>
<span class="go">    │   └── annotations.yaml</span>
<span class="go">    └── Dockerfile</span>
<span class="go">...</span>
</code></pre></div>
<p>Simply build your bundle using the <code>Dockerfile</code> that is part of every Operator bundle. If you are new to this format please consult the <a href="https://github.com/operator-framework/operator-registry/blob/master/docs/design/operator-bundle.md">operator-registry</a> documentation.  If you used <code>operator-sdk</code> to develop your Operator you can also leverage its packaging tooling to <a href="https://sdk.operatorframework.io/docs/olm-integration/quickstart-bundle/#creating-a-bundle">create a bundle</a>.</p>
<p>To build your bundle simply build the image and push it to a registry of your choice:</p>
<div class="codehilite"><pre><span></span><code><span class="go">podman build -f 2.0.0/Dockerfile -t my-operator:v2.0.0 2.0.0/</span>
<span class="go">podman push my-operator:v2.0.0 quay.io/myaccount/my-operator:v2.0.0</span>
</code></pre></div>
<p>With the bundle published to a registry you can now leverage <code>opm</code> to add it to the existing catalog of community operators:</p>
<ul>
<li>for OpenShift this is <code>quay.io/openshift-community-operators/catalog:latest</code></li>
<li>for OperatorHub.io this is <code>quay.io/operatorhubio/catalog:latest</code></li>
</ul>
<p><code>opm</code> will create a catalog image with your Operator added, like so:</p>
<div class="codehilite"><pre><span></span><code><span class="go">opm index add --bundles quay.io/myaccount/my-operator:v2.0.0 --from-index quay.io/operatorhubio/catalog:latest --tag quay.io/myaccount/my-test-catalog:latest</span>
</code></pre></div>
<p>You then push the resulting catalog image to a registry of your choice as well:</p>
<div class="codehilite"><pre><span></span><code><span class="go">podman push quay.io/myaccount/my-test-catalog:latest</span>
</code></pre></div>
<blockquote>
<p><code>opm</code> also supports multiple container tools via the <code>-c</code> switch. You can also omit the final step to build the catalog image and instead output the <code>Dockerfile</code> that would be used. Consult the help output for that via <code>opm index add --help</code></p>
</blockquote>
<p>You now have a catalog image available for OLM to install your Operator version from.</p>
<h2 id="testing-operator-deployment-on-kubernetes">Testing Operator Deployment on Kubernetes</h2>
<h3>1. Installing Operator Lifecycle Manager</h3>
<p>If you are not using OpenShift you first need to install the Operator Lifecycle Manager on your cluster.</p>
<p>The following steps assume you already have a running Kubernetes cluster that is currently selected as your <code>current-context</code> via <code>kubectl</code>. If you, you can quickly spin up a cluster using tools like <code>KIND</code> or <code>minikube</code> mentioned in the <a href="#pre-requisites">pre-requisites section</a> , e.g.</p>
<div class="codehilite"><pre><span></span><code><span class="go">kind create cluster</span>
</code></pre></div>
<p>Install the Operator Lifecycle Manager using <code>operator-sdk</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="go">operator-sdk olm install</span>
</code></pre></div>
<p>Verify that OLM installed correctly:</p>
<div class="codehilite"><pre><span></span><code><span class="go">operator-sdk olm status</span>
</code></pre></div>
<p>This should output something like the following:</p>
<div class="codehilite"><pre><span></span><code><span class="go">INFO[0000] Fetching CRDs for version "0.16.1"</span>
<span class="go">INFO[0000] Fetching resources for version "0.16.1"</span>
<span class="go">INFO[0002] Successfully got OLM status for version "0.16.1"</span>

<span class="go">NAME                                            NAMESPACE    KIND                        STATUS</span>
<span class="go">operators.operators.coreos.com                               CustomResourceDefinition    Installed</span>
<span class="go">operatorgroups.operators.coreos.com                          CustomResourceDefinition    Installed</span>
<span class="go">installplans.operators.coreos.com                            CustomResourceDefinition    Installed</span>
<span class="go">clusterserviceversions.operators.coreos.com                  CustomResourceDefinition    Installed</span>
<span class="go">olm-operator                                    olm          Deployment                  Installed</span>
<span class="go">subscriptions.operators.coreos.com                           CustomResourceDefinition    Installed</span>
<span class="go">olm-operator-binding-olm                                     ClusterRoleBinding          Installed</span>
<span class="go">operatorhubio-catalog                           olm          CatalogSource               Installed</span>
<span class="go">olm-operators                                   olm          OperatorGroup               Installed</span>
<span class="go">aggregate-olm-view                                           ClusterRole                 Installed</span>
<span class="go">catalog-operator                                olm          Deployment                  Installed</span>
<span class="go">aggregate-olm-edit                                           ClusterRole                 Installed</span>
<span class="go">olm                                                          Namespace                   Installed</span>
<span class="go">global-operators                                operators    OperatorGroup               Installed</span>
<span class="go">operators                                                    Namespace                   Installed</span>
<span class="go">packageserver                                   olm          ClusterServiceVersion       Installed</span>
<span class="go">olm-operator-serviceaccount                     olm          ServiceAccount              Installed</span>
<span class="go">catalogsources.operators.coreos.com                          CustomResourceDefinition    Installed</span>
<span class="go">system:controller:operator-lifecycle-manager                 ClusterRole                 Installed</span>
</code></pre></div>
<h4>Troubleshooting</h4>
<p>If any problems are encountered at this step, verify that you have enough permissions to install OLM (you need to be <code>cluster-admin</code> to register its CRDs) and create an issue in the <a href="https://github.com/operator-framework/operator-lifecycle-manager/issues">OLM tracker</a>.</p>
<h3>2. Adding the catalog containing your Operator</h3>
<p>Create a <code>CatalogSource</code> instance in the <code>olm</code> namespace to reference in the Operator catalog image that contains your Operator version to test:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">operators.coreos.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CatalogSource</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-test-catalog</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">olm</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">sourceType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpc</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">quay.io/myaccount/my-test-catalog:latest</span>
</code></pre></div>
<p>Deploy the <code>CatalogSource</code> resource:</p>
<div class="codehilite"><pre><span></span><code><span class="err">kubectl apply -f catalog-source.yaml</span>
</code></pre></div>
<p><strong>If you created your test catalog containing all existing community operators</strong>, you should delete the default catalog that OLM ships with to avoid a lot of duplicate entries:</p>
<div class="codehilite"><pre><span></span><code><span class="err">kubectl delete catalogsource operatorhubio-catalog -n olm</span>
</code></pre></div>
<p>Verify your custom catalog got loaded:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl get catalogsource -n olm
<span class="go">NAME                           DISPLAY     TYPE   PUBLISHER   AGE</span>
<span class="go">my-test-catalog                            grpc               3m32s</span>
<span class="go">[...]</span>
</code></pre></div>
<p>Verify the health of your catalog:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl get catalogsource my-test-catalog -n olm -o yaml</span>
</code></pre></div>
<h4>Troubleshooting</h4>
<p>The <code>status</code> section of that object have the <code>lastObservedState</code> condition set to <code>READY</code>. If that is not the case (for example if the condition is set to <code>CONNECTING</code>) check the healthiness of the pod associated to the catalog in the same namespace.</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl get pod -n olm</span>
</code></pre></div>
<p>The name of the pod will carry the name of the <code>CatalogSource</code> object plus 5 random characters. Usually the source of unhealthy catalogs is catalog pods with pull errors due to missing authentication against the registry or non-existent tags.
If the pod is actually running check its logs:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl logs my-test-catalog-zcq7h -n olm</span>
</code></pre></div>
<p>If there are errors in this log please raise them in the <code>operator-registry</code> <a href="https://github.com/operator-framework/operator-registry">issue tracker</a> as any problems caused by malformed bundle/packagemanifest metadata should have been caught during catalog creation.</p>
<h3>3. View Available Operators</h3>
<p>Inspect the list of loaded <code>packagemanifests</code> on the system with the following command to filter for your Operator</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl get packagemanifests | grep my-operator</span>
</code></pre></div>
<p>The example should look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="go">grep my-operator                        1h2m</span>
</code></pre></div>
<p>If your Operator appears in this list, the catalog was successfully parsed and the Operator is now available to install.</p>
<h4>Troubleshooting</h4>
<p>If it does not appear in this list return to the previous step and check the logs of the catalog pod. If this does not reveal any error messages check the log of both the <code>packageserver</code> pods of OLM in the <code>olm</code> namespace, e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl get logs packageserver-78c99949df-lf26p -n olm</span>
</code></pre></div>
<p>In some occassions the Operator definition is in the catalog but cannot be understood due to some malformed package/bundle content. This case the <code>packageserver</code> should present a related error message.
If there are errors in this log please raise them in the <code>operator-registry</code> <a href="https://github.com/operator-framework/operator-registry">issue tracker</a> as any problems caused by malformed bundle/packagemanifest metadata should have been caught during catalog creation.</p>
<h3>4. Create an OperatorGroup</h3>
<p>An <code>OperatorGroup</code> is used to denote which namespaces your Operator should be watching. It must exist in the namespace where your operator should be deployed, we'll use <code>default</code> in this example.
Its configuration depends on whether your Operator supports watching its own namespace, a single other namespace or all namespaces (as indicated by <code>spec.installModes</code> in the CSV).</p>
<p>Create the following file as  <code>operator-group.yaml</code> if your Operator supports watching its own or a single namespace.</p>
<blockquote>
<p>If your Operator supports watching all namespaces you can skip this step and proceed to creating the <code>Subscription</code> object in the <code>operators</code> namespace. An <code>OperatorGroup</code> already exists there with <code>spec.targetNamespace</code> empty. This kind of <code>OperatorGroup</code> instructs the Operator to watch all namespaces.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">operators.coreos.com/v1alpha2</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OperatorGroup</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-operatorgroup</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">targetNamespaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</code></pre></div>
<p>Deploy the <code>OperatorGroup</code> resource:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl apply -f operator-group.yaml</span>
</code></pre></div>
<h3>5. Create a Subscription</h3>
<p>The last steps is to ask OLM to install your Operator. A <code>Subscription</code> is created to represent the intent to install an Operator and keep it updated (automatically even) with newer version from the catalog. This requires you to tell OLM which Operator, in which version from which channel you want to install and where the catalog is, that contains the Operator.</p>
<p>Save the following to a file named: <code>operator-subscription.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">operators.coreos.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Subscription</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-operator-subscription</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">channel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;channel-name&gt;</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-operator</span>
  <span class="nt">startingCSV</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-operator.v2.0.0</span>
  <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-test-catalog</span>
  <span class="nt">sourceNamespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">olm</span>
</code></pre></div>
<p>If your Operator supports watching all namespaces, change the namespace of the namespace of the <code>Subscription</code> from <code>default</code> to <code>operators</code>. (This namespace already has an <code>OperatorGroup</code>).</p>
<p>In any case replace <code>&lt;channel-name&gt;</code> with the contents of <code>channel.name</code> in your <code>package.yaml</code> file if you have the <code>packagemanifest</code> format or with the contents from <code>operators.operatorframework.io.bundle.channels.v1</code> in <code>annotations.yaml</code> if you have the <code>bundle</code> format.</p>
<p>Then create the <code>Subscription</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl apply -f operator-subscription.yaml</span>
</code></pre></div>
<h4>Troubleshooting</h4>
<p>Note that the <code>Subscription</code> object is not representing your installed Operator (this is the object in the next step). It only intructs OLM to install your Operator and keep it updated (automatically). Any error message in the <code>Subscription</code> status refers to the attempt to install the Operator from the catalog, which is usually caused by incorrect references to the catalog (types in the name of the Operator, catalog, namespace, etc).</p>
<h3>6. Verify Operator health</h3>
<p>Watch your Operator being deployed by OLM from the catalog with the following command. Change the namespace from <code>default</code> to <code>operators</code> if you installed your <code>Subscrption</code> there. Use the watch switch <code>-w</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl get clusterserviceversion -n default -w
<span class="go">NAME                     DISPLAY          VERSION   REPLACES                PHASE</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Pending</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      InstallReady</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Installing</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Installing</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Installing</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Installing</span>
<span class="go">my-operator.v2.0.0       My Operator      2.0.0     my-operator.v1.0.0      Succeeded</span>
</code></pre></div>
<p>The <code>ClusterServiceVersion</code> object represents your installed Operator per version. It can take a couple of seconds to be created as part of the <code>Subscription</code> request. There will always be a <code>ClusterServiceVersion</code> in the namespace of the <code>Subscription</code>. If the <code>OperatorGroup</code> was configured to "watch" a list or all namespaces, the <code>ClusterServiceVersion</code> object will be copied to all those namespaces. This might take additional time (usually around 30 secs).</p>
<p>If the above command succeeds and the <code>ClusterServiceVersion</code> has transitioned to the <code>Succeeded</code> phase you will also find your Operator's <code>Deployment(s)</code> in the same namespace where the <code>Subscription</code> is. This is your Operator running:</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl get deployment -n default</span>
</code></pre></div>
<h4>Troubleshooting</h4>
<p>If the <code>ClusterServiceVersion</code> is in a pending or failed state, problems occurred when trying to install the Operator. There are two common sources: the components that make up the Operator and the Operator binary itself.</p>
<p>Problems with the Operator process itself will result in a <code>Deployment</code> that is unhealthy, either due to a crashing Operator pod or other image level problems. In this case debug the <code>Deployment</code> and Operator logs for any error message. Usually there are either bugs in the Operator or insufficient permissions in the RBAC part of the bundle/package metadata which may crash poorly written Operators.</p>
<p>Problems with installing the Operator components can be debugged with the <code>InstallPlan</code> object. It contains a blueprint of the Operator and lists all the Kubernetes resources that are required for the Operator to function. It is automatically created by OLM and linked to the <code>Subscription</code>. If the <code>Subscription</code> created an <code>InstallPlan</code> you can refer to via the status block of the <code>Subscription</code>: <code>.status.InstallPlan</code> contains the name of the <code>InstallPlan</code> object which is always in the same namespace as the <code>Subscription</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl describe subscription my-operator-subscription -n default</span>

<span class="go">...</span>
<span class="go">Status:</span>
<span class="go">...</span>

<span class="go">  Installplan:</span>
<span class="go">    API Version:  operators.coreos.com/v1alpha1</span>
<span class="go">    Kind:         InstallPlan</span>
<span class="go">    Name:         install-2c8lf</span>
<span class="go">    Uuid:         656e2e6b-582a-46e1-867d-4f7e95c24136</span>
<span class="go">  Last Updated:   2020-11-01T19:38:01Z</span>
<span class="go">  State:          AtLatestKnown</span>
<span class="go">Events:           &lt;none&gt;</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="go">kubectl describe installplan install-2c8lf -n default</span>
</code></pre></div>
<p>This will likely be a lengthy output due to the content of every component of the Operator returned. However, in the <code>.status</code> block of this object the name and health of every component is displayed. Problems with <code>InstallPlan</code> components usually stem from malformed components, insufficient permissions, collisions with existing objects etc. It usually needs to be corrected at the Operator metadata level.</p>
<h2 id="testing-operator-deployment-on-openshift">Testing Operator Deployment on OpenShift</h2>
<p>The process to test on OpenShift Container Platform and OKD 4.3 or newer is exactly the same as described <a href="#testing-operator-deployment-on-kubernetes">above</a> with the exception that OLM is already installed. You can use the same CLI steps to test your Operator but it can however also be done via the UI.</p>
<h3>1. Create the CatalogSource</h3>
<p>Create a <code>CatalogSource</code> instance in the <code>openshift-marketplace</code> namespace to reference the Operator catalog image that contains your Operator version to test:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">operators.coreos.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CatalogSource</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-test-catalog</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openshift-marketplace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">sourceType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grpc</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">quay.io/myaccount/my-test-catalog:latest</span>
</code></pre></div>
<p>You can use the OpenShift Console YAML editor for that or deploy the <code>CatalogSource</code> resource on the CLI:</p>
<div class="codehilite"><pre><span></span><code><span class="go">oc apply -f catalog-source.yaml</span>
</code></pre></div>
<p><strong>If you created your test catalog containing all existing community operators</strong>, you should delete the default catalog that OLM ships with to avoid a lot of duplicate entries. To do this navigate to <strong>Administration</strong> on the main navigation bar on the left and select the <strong>Cluster Settings</strong> item.  In this view, select the <strong>Global Configuration</strong> tab and filter for <code>OperatorHub</code>:</p>
<p><img alt="OpenShift Cluster Settings" src="../images/openshift-cluster-configuration.png"/></p>
<p>Click on the <code>OperatorHub</code> item and select the <strong>YAML</strong> tab. In the YAML editor set the <code>disabled</code> property for the <code>community-catalog</code> to <code>true</code>:</p>
<p><img alt="OpenShift OperatorHub Settings" src="../images/openshift-operatorhub-settings.png"/></p>
<p>Click <strong>Save</strong>.</p>
<h3>2. Find your Operator in the OperatorHub UI</h3>
<p>Go to your OpenShift UI and find your Operator by filtering for the <em>Custom</em> category:
<img alt="Find your Operator in OperatorHub" src="../images/my-operator-in-hub.png"/></p>
<h3>3. Install your Operator from OperatorHub</h3>
<p>To install your Operator simply click its icon and in the proceeding dialog click <em>Install</em>.
<img alt="Install your Operator from OperatorHub" src="../images/my-operator-install.png"/>
 You will be asked where to install your Operator. Select either of the desired installation modes, if your Operator supports it and then click <em>Subscribe</em>
<img alt="Install your Operator from OperatorHub" src="../images/my-operator-subscription.png"/>
You will be forwarded to the <em>Subscription Management</em> section of the OLM UI and after a couple of moments your Operator will be transitioning to <em>Installed</em>.
<img alt="Subscribe to your Operator from OperatorHub" src="../images/my-operator-subscribed.png"/></p>
<h3>4. Verify Operator health</h3>
<p>Change to the <em>Installed Operators</em> section in the left-hand navigation menu to verify your Operator's installation status:
<img alt="See your installed Operator" src="../images/my-operator-installed.png"/>
It should have transitioned into the state <em>InstallationSucceeded</em>. You can now test it by starting to use its APIs.</p>
<h2 id="testing-with-scorecard">Testing with scorecard</h2>
<p>If your Operator is up and running you can verify it is working as intended using its APIs. Additionally you can run <a href="https://sdk.operatorframework.io/docs/advanced-topics/scorecard/scorecard/">operator-sdk</a>'s <code>scorecard</code> utility for validating against good practice and correctness of your Operator.
Assuming you are still in your top-level directory where <code>my-operator/</code> is your bundle location following these instructions to test your Operator using the <code>Operator-SDK</code>: <a href="https://sdk.operatorframework.io/docs/advanced-topics/scorecard/scorecard/#running-the-scorecard">Running your Operator with scorecard</a></p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://github.com/operator-framework/operator-lifecycle-manager/blob/master/doc/design/building-your-csv.md">Cluster Service Version Spec</a></li>
<li><a href="https://github.com/operator-framework/bundle-example">Example Bundle</a></li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../operator-versioning/" rel="prev" title="Versioning">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Versioning
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../using-current-test-suite/" rel="next" title="Via test suite">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Via test suite
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/vendor.606193c2.min.js"></script>
<script src="../assets/javascripts/bundle.b90b6d1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: "..",
          features: ["navigation.tabs", "navigation.sections", "navigation.expand", "toc.integrate"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>