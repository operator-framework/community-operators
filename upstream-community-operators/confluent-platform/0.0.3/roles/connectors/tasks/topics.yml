---
- name: "create topic {{ meta.name }}"
  kafka_lib:
    api_version: "1.0.1"
    resource: "topic"
    name: "{{ meta.name }}"
    partitions: "{{ partitions }}"
    replica_factor: "{{ replication_factor }}"
    options:
      cleanup.policy: "{{ options.cleanup_policy }}"
      confluent.key.schema.validation: "{{ options.confluent_key_schema_validation | default(omit) }}"
      confluent.key.subject.name.strategy: "{{ options.confluent_key_subject_name_strategy | default(omit) }}"
      confluent.placement.constraints: "{{ options.confluent_placement_constraints | default(omit) }}"
      confluent.value.schema.validation: "{{ options.confluent_value_schema_validation | default(omit) }}"
      confluent.value.subject.name.strategy: "{{ options.confluent_value_subject_name_strategy | default(omit) }}"
      compression.type: "{{ options.compression_type | default(omit) }}"
      delete.retention.ms: "{{ options.delete_retention_ms | default(omit) }}"
      file.delete.delay.ms: "{{ options.file_delete_delay_ms | default(omit) }}"
      flush.messages: "{{ options.flush_messages | default(omit) }}"
      flush.ms: "{{ options.flush_ms | default(omit) }}"
      follower.replication.throttled.replicas: "{{ options.follower_replication_throttled_replicas | default(omit) }}"
      index.interval.bytes: "{{ options.index_interval_bytes | default(omit) }}"
      leader.replication.throttled.replicas: "{{ options.leader_replication_throttled_replicas | default(omit) }}"
      max.compaction.lag.ms: "{{ options.max_compaction_lag_ms | default(omit) }}"
      max.message.bytes: "{{ options.max_message_bytes | default(omit) }}"
      message.downconversion.enable: "{{ options.message_downconversion_enable | default(omit) }}"
      message.format.version: "{{ options.message_format_version | default(omit) }}"
      message.timestamp.difference.max.ms: "{{ options.message_timestamp_difference_max_ms | default(omit) }}"
      message.timestamp.type: "{{ options.message_timestamp_type | default(omit) }}"
      min.cleanable.dirty.ratio: "{{ options.min_cleanable_dirty_ratio | default(omit) }}"
      min.compaction.lag.ms: "{{ options.min_compaction_lag_ms | default(omit) }}"
      min.insync.replicas: "{{ options.min_insync_replicas | default(omit) }}"
      preallocate: "{{ options.preallocate | default(omit) }}"
      retention.bytes: "{{ options.retention_bytes | default(omit) }}"
      retention.ms: "{{ options.retention_ms | default(omit) }}"
      segment.bytes: "{{ options.segment_bytes | default(omit) }}"
      segment.index.bytes: "{{ options.segment_index_bytes | default(omit) }}"
      segment.jitter.ms: "{{ options.segment_jitter_ms | default(omit) }}"
      segment.ms: "{{ options.segment_ms | default(omit) }}"
      unclean.leader.election.enable: "{{ options.unclean_leader_election_enable | default(omit) }}"
    zookeeper: "{{ kafka_zookeeper_connect }}"
    bootstrap_servers:  "{{ kafka_servers }}"
    state: "{{ state | default('present') }}"
