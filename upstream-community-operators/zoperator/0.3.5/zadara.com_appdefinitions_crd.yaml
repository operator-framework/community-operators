apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: appdefinitions.zadara.com
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.autoDiscover
    name: AutoDiscover
    type: boolean
  - JSONPath: .spec.namespace
    name: AppNamespace
    type: string
  - JSONPath: .status.state
    name: Status
    type: string
  - JSONPath: .spec.selector.matchLabels
    name: Selector
    type: string
  group: zadara.com
  names:
    kind: AppDefinition
    listKind: AppDefinitionList
    plural: appdefinitions
    singular: appdefinition
  scope: Cluster
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: AppDefinition allows to define which Kubernetes resources compose
        an Application, as a logical unit. This is done by means of namespaces and
        label-based selectors. The result of the query should include workloads (e.g
        Deployments, StatefulSets), RBAC, configuration (Secrets, ConfigMaps), storage,
        and all other resources required for the application to run.
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: AppDefinitionSpec defines the desired state of AppDefinition
          properties:
            autoDiscover:
              description: Application Definition was automatically created by Zadara
                Operator
              type: boolean
            namespace:
              description: Namespace to include in ApplicationSnapshots
              type: string
            selector:
              description: Selector for API Resources (PVCs, Deployments, etc.) to
                include in as Application
              properties:
                matchExpressions:
                  description: matchExpressions is a list of label selector requirements.
                    The requirements are ANDed.
                  items:
                    description: A label selector requirement is a selector that contains
                      values, a key, and an operator that relates the key and values.
                    properties:
                      key:
                        description: key is the label key that the selector applies
                          to.
                        type: string
                      operator:
                        description: operator represents a key's relationship to a
                          set of values. Valid operators are In, NotIn, Exists and
                          DoesNotExist.
                        type: string
                      values:
                        description: values is an array of string values. If the operator
                          is In or NotIn, the values array must be non-empty. If the
                          operator is Exists or DoesNotExist, the values array must
                          be empty. This array is replaced during a strategic merge
                          patch.
                        items:
                          type: string
                        type: array
                    required:
                    - key
                    - operator
                    type: object
                  type: array
                matchLabels:
                  additionalProperties:
                    type: string
                  description: matchLabels is a map of {key,value} pairs. A single
                    {key,value} in the matchLabels map is equivalent to an element
                    of matchExpressions, whose key field is "key", the operator is
                    "In", and the values array contains only "value". The requirements
                    are ANDed.
                  type: object
              type: object
          required:
          - namespace
          type: object
        status:
          description: AppDefinitionStatus defines the observed state of AppDefinition
          properties:
            apiObjects:
              description: API objects (Deployments, StatefulSets, ConfigMaps, etc.)
                matching namespace and selector defined in the Spec. These objects
                will be included in ApplicationSnapshot.
              items:
                type: string
              type: array
            state:
              description: 'State of the application snapshot is one of the following:
                Pending - Application definition is waiting to Operator initialization.
                DoesNotExist - Application is not installed on cluster. NotRunning
                - Application exists on cluster but not running (no active pods running).
                Running - Application is running on cluster.'
              enum:
              - Pending
              - DoesNotExist
              - NotRunning
              - Running
              type: string
          required:
          - state
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
